{% extends (craft.app.request.isAjax and not craft.app.request.isLivePreview) ? '_ajax-layout' : '_layout' %}

{% if entry is not defined %}
  {% set entry = craft.entries.section('workIndex').one() %}
{% endif %}

{% set title = 'Work' %}
{% set bodyClass = 'with-blobs' %}
{% if entry.seoTitle %}{% set seoTitle = entry.seoTitle %}{% endif %}
{% if entry.seoDescription %}{% set seoDescription = entry.seoDescription %}{% endif %}
{% if entry.seoImage|length %}{% set seoImage = entry.seoImage.one() %}{% endif %}

{% set sectionHeader = 'All Projects' %}
{% set filterLinks = '<a href="#" class="filter-projects" data-no-swup>Filter Projects</a>' %}

{% if category is defined %}

  {% if category.group == 'Services' %}
    {% set projectEntries = craft.superTable.getRelatedElements({
      relatedTo: {
        targetElement: category,
        field: 'services.service'
      },
      section: 'work',
    }) %}
  {% else %}
    {% set projectEntries = craft.entries({
      relatedTo: category,
      section: 'work',
    }) %}
  {% endif %}
  {% set sectionHeader = '%s Projects <a href="/work" data-no-swup><span class="visually-hidden">Clear Filter</span><svg class="icon-close" aria-hidden="true" role="presentation"><use xlink:href="#icon-close"/></svg></a>'|format(category.title) %}

{% else %}

  {% set projectEntries = craft.entries({
    section: 'work',
  }) %}

{% endif %}

{% block content %}

  {% include 'partials/_text-header' %}

  <div class="container">
    <div class="block-section-header top-section-header">
      <h3 class="filtered-title">{{ sectionHeader|raw }}</h3>
      {% include 'work/_filters' %}
    </div>
    <div id="projects-container" aria-live="polite">
      <div class="thumbnail-grid grid spaced">
        {% for projectEntry in projectEntries.with([
            'altImage',
            'services.service',
          ]).all() %}
          {% include 'work/_article' with { entry: projectEntry } %}
        {% endfor %}
      </div>
    </div>
  </div>

{% endblock %}
