{% extends (craft.app.request.isAjax and not craft.app.request.isLivePreview) ? "_ajax-layout" : "_layout" %}

{% block content %}

  {% include 'partials/_page-header' %}

  <section class="portfolio">
    <ul class="projects filter-items clearfix">
      {% set entries = craft.entries({
          section: 'work',
          with: [
            'services',
            'industry',
            'altImage',
            'mainImage'
          ]
      }) %}
      {% for entry in entries.all() %}
        {% set altImage = entry.altImage[0] ?? null %}
        {% if entry.altImage %}
          {% set mainImage = altImage %}
        {% else %}
          {% set mainImage = entry.mainImage[0] ?? null %}
        {% endif %}
        <li class="project interior" data-services="{% for service in entry.services %}{{ service.slug }} {% endfor %}" data-industry="{% for industry in entry.industry %}{{ industry.slug }} {% endfor %}">
          <article>
            {% if mainImage %}
              {% set transformedImage = craft.imager.transformImage(mainImage, { width: 900, height: 600, mode: 'crop' }) %}
              <div class="project-image lazyload" data-bg="{{ craft.app.config.general.cdnUrl }}{{ transformedImage.getUrl() }}"></div>
            {% endif %}
            <header>
              <h1><a href="{{ entry.getUrl() }}">{{ entry.title }}</a></h1>
              {% if entry.rolloverSubtitle %}
                <h3>{{ entry.rolloverSubtitle }}</h3>
              {% endif %}
            </header>
            <a aria-label="{{ entry.title }}: {{ entry.rolloverSubtitle }}" class="view-project" href="{{ entry.getUrl() }}"><span>View Project</span></a>
          </article>
        </li>
      {% endfor %}
    </ul>
  </section>
{% endblock %}
