{% extends (craft.app.request.isAjax and not craft.app.request.isLivePreview) ? '_ajax-layout' : '_layout' %}

{% if entry is not defined %}
  {% set entry = craft.entries.section('workIndex').one() %}
{% endif %}

{% set title = entry.title %}
{% if entry.seoTitle %}{% set seoTitle = entry.seoTitle %}{% endif %}
{% if entry.seoDescription %}{% set seoDescription = entry.seoDescription %}{% endif %}
{% set bodyClass = 'single page work with-blobs' %}
{% set bodyDataAttributes = 'data-blob-color="#FF3D00"' %}
{% set sectionHeader = 'All Projects' %}
{% set filterLinks = '<a href="#" class="filter-projects">Filter Projects</a>' %}

{% if category is defined %}

  {% set projectEntries = craft.superTable.getRelatedElements({
    relatedTo: {
      targetElement: category,
      field: 'services.service'
    },
    section: 'work'
  }) %}
  {# todo: make these fields on services? or is this hardcoded? #}
  {% set headline = 'Check out all our %s projects.'|format(category.title|lower) %}
  {% set subhead = 'Feast your eyes.' %}
  {% set sectionHeader = 'All %s Projects'|format(category.title) %}
  {% set filterLinks = '<a href="/work">Clear Filter</a>' %}

{% else %}
  {% set projectEntries = craft.entries({
    section: 'work',
    with: [
      'altImage',
    ]
  }) %}
{% endif %}

{% block content %}

  {% if category is defined %}
    {% include 'partials/_text-header' with { headline: headline, subhead: subhead } %}
  {% else %}
    {% include 'partials/_text-header' %}
  {% endif %}

  <div class="container">
    <div class="block-section-header top-section-header">
      <h3>{{ sectionHeader }}</h3>
      <div class="filter-links">
        {{ filterLinks|raw }}
      </div>
    </div>
    <div class="thumbnail-grid grid spaced">
      {% for projectEntry in projectEntries.all() %}
        {% include 'work/_article' with { entry: projectEntry } %}
      {% endfor %}
    </div>
  </div>

{% endblock %}
